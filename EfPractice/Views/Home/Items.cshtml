@model EfPractice.Models.ItemsViewModel

@{
	ViewData["Title"] = "Item Profile";
}
<meta charset="utf-8" />
<title>@ViewData["Title"] - My ASP.NET Application</title>

<style>
	.form-control {
		width: 100%;
	}

	.table-container {
		max-height: 250px;
		overflow-y: auto;
	}

	thead {
		background-color: #007bff;
		color: white;
	}

	.text-danger {
		font-size: .75rem;
	}
</style>

<div class="container mt-5">
	<h2 class="mb-4">Products</h2>
	<form asp-action="Items" asp-controller="Home" method="post" novalidate>
		@Html.ValidationSummary(true, "", new { @class = "text-danger" })
		<input type="hidden" asp-for="Item.Id" />
		<div class="tab-content border border-top-0 p-3 bg-white">
			<div>
				<div class="row g-3">
					<div class="col-md-3">
						<label asp-for="Item.Code">Code</label>
						<input asp-for="Item.Code" class="form-control" />
						<span asp-validation-for="Item.Code" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.Name">Name</label>
						<input asp-for="Item.Name" class="form-control" />
						<span asp-validation-for="Item.Name" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.UOM">Unit</label>
						<select asp-for="Item.UOM" asp-items="Model.Units" class="form-select">
							<option value="1">Numbers</option>
							<option value="2">Pieces</option>
							<option value="3">Units</option>
						</select>
						<span asp-validation-for="Item.UOM" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.ReorderLevel">Reorder Level</label>
						<input asp-for="Item.ReorderLevel" class="form-control" />
						<span asp-validation-for="Item.ReorderLevel" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.Category">Category</label>
						<select asp-for="Item.Category" asp-items="Model.Categories" class="form-select"></select>
						<span asp-validation-for="Item.Category" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.SubCategory">Sub Category</label>
						<select asp-for="Item.SubCategory" asp-items="Model.SubCategories" class="form-select"></select>
						<span asp-validation-for="Item.SubCategory" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.BuyingRate">Buying Rate</label>
						<input asp-for="Item.BuyingRate" class="form-control" />
						<span asp-validation-for="Item.BuyingRate" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.ListPrice">List Price</label>
						<input asp-for="Item.ListPrice" class="form-control" />
						<span asp-validation-for="Item.ListPrice" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.PosRate">Price 1 / POS Rate</label>
						<input asp-for="Item.PosRate" class="form-control" />
						<span asp-validation-for="Item.PosRate" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.HSCode">HS Code</label>
						<input asp-for="Item.HSCode" class="form-control" />
						<span asp-validation-for="Item.HSCode" class="text-danger"></span>
					</div>
					<div class="col-md-3 form-check pt-4">
						<input asp-for="Item.Active" class="form-check-input" />
						<label asp-for="Item.Active" class="form-check-label">Active</label>
					</div>
				</div>
				<br>
				<br>
				<h4 class="mb-4">Product Barcode</h4>
				<div class="row g-3">
					<div class="col-md-3">
						<label asp-for="Item.BarcodeNo">Barcode No</label>
						<input asp-for="Item.BarcodeNo" class="form-control" />
						<span asp-validation-for="Item.BarcodeNo" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.BarcodePrice">Barcode Price</label>
						<input asp-for="Item.BarcodePrice" class="form-control" />
						<span asp-validation-for="Item.BarcodePrice" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.Brand">Brand</label>
						<select asp-for="Item.Brand" asp-items="Model.Brands" class="form-select"></select>
						<span asp-validation-for="Item.Brand" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.Label">Label</label>
						<textarea asp-for="Item.Label" class="form-control" rows="2"></textarea>
						<span asp-validation-for="Item.Label" class="text-danger"></span>
					</div>
				</div>
				<br>
				<br>
				<h4 class="mb-4">Product Taxes</h4>
				<div class="row g-3">
					<div class="col-md-3">
						<label asp-for="Item.TaxId">Tax</label>
						<select asp-for="Item.TaxId" asp-items="Model.Taxes" class="form-select"></select>
						<span asp-validation-for="Item.TaxId" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.TaxRate">Tax Rate</label>
						<input asp-for="Item.TaxRate" class="form-control" />
						<span asp-validation-for="Item.TaxRate" class="text-danger"></span>
					</div>
					<div class="col-md-3">
						<label asp-for="Item.TaxType">Tax Type</label>
						<select asp-for="Item.TaxType" class="form-select">
							<option value="GST">GST</option>
							<option value="VAT">VAT</option>
							<option value="SalesTax">Sales Tax</option>
						</select>
						<span asp-validation-for="Item.TaxType" class="text-danger"></span>
					</div>
				</div>
			</div>


		</div>
		<div class="mt-3 d-flex gap-2">
			<button type="submit" class="btn btn-primary">Save</button>
			<button type="reset" class="btn btn-secondary">Reset</button>
		</div>
	</form>
	<hr />
	<div class="table-container">
		<table id="itemTable" class="table table-bordered">
			<thead>
				<tr>
					<th>ID</th>
					<th>Code</th>
					<th>Name</th>
					<th>Unit</th>
					<th>Category</th>
					<th>Buying Rate</th>
					<th>List Price</th>
					<th>POS Rate</th>
					<th>Active</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var i in Model.Items)
				{
					<tr>
						<td>@i.Id</td>
						<td>@i.Code</td>
						<td>@i.Name</td>
						<td>@i.UOM</td>
						<td>@i.Category</td>
						<td>@i.BuyingRate</td>
						<td>@i.ListPrice</td>
						<td>@i.PosRate</td>
						<td>@(i.Active ? "Yes" : "No")</td>
						<td>
							<a asp-action="Items" asp-route-id="@i.Id" class="btn btn-sm btn-warning">Edit</a>
							<a asp-action="ItemsDelete" asp-route-id="@i.Id" class="btn btn-sm btn-danger">Delete</a>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>

@section Scripts {
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<partial name="_ValidationScriptsPartial" />
}

<script>
	$('#Item_TaxId').change(function () {
		var id = $(this).val();
		if (!id) return;

		$.getJSON('/Home/GetTaxRate', { id: id }, function (d) {
			$('#Item_TaxRate').val(d.rate);
			$('#Item_TaxType').val(d.type);
			console.log(d);
		});
	});

	$('#Item_Category').change(function () {
		var id = $(this).val();
		if (!id) return;

		$.getJSON('/Home/SubCategory', { id: id }, function (d) {
			var $ddl = $('#Item_SubCategory');
			$ddl.empty(); // clear old options
			$ddl.append($('<option>').val('').text('-- Select -- '));			
			$.each(d, function (i, item) {
				console.log(item);
				$ddl.append($('<option>').val(item.id).text(item.name));
			});
		});
	});

</script>